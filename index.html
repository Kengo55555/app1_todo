<!DOCTYPE html>
<!--
    Todoç®¡ç†ã‚¢ãƒ—ãƒª
    è¦ä»¶å®šç¾©æ›¸: ä½œæ¥­æŒ‡ç¤º_è¦ä»¶å®šç¾©.md ã«åŸºã¥ãå®Ÿè£…
    
    æ©Ÿèƒ½è¦ä»¶: F-001 ï½ F-015 ã‚’ã™ã¹ã¦å®Ÿè£…
    éæ©Ÿèƒ½è¦ä»¶: æ€§èƒ½ã€å¯ç”¨æ€§ã€ä¿å®ˆæ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ã‚¤ãƒ³ãƒ•ãƒ©ã€ã‚µã‚¤ãƒˆè¦ä»¶ã‚’æº€ãŸã™
    
    å®Ÿè£…æŠ€è¡“:
    - HTMLã€CSSã€JavaScriptã®ã¿ï¼ˆå¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸ä½¿ç”¨ï¼‰
    - localStorageã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
    - mailtoãƒªãƒ³ã‚¯ã«ã‚ˆã‚‹ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ
-->
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todoç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color-1: #667eea;
            --primary-color-2: #764ba2;
            --stat-card-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --button-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --body-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--body-bg);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin: 0;
        }

        .settings-button {
            background: var(--button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .settings-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        input[type="text"],
        input[type="date"],
        input[type="email"],
        input[type="color"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color-1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
        }

        button {
            background: var(--button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-add {
            width: 100%;
            margin-top: 10px;
        }

        .todo-list {
            margin-top: 30px;
        }

        .todo-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: center;
            transition: all 0.3s;
        }

        .todo-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .todo-item.due-tomorrow {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .todo-item.due-today {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .todo-item.overdue {
            background: #f5c6cb;
            border-color: #c82333;
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-content {
            font-weight: 500;
            color: #333;
        }

        .todo-date {
            color: #666;
            font-size: 14px;
        }

        .todo-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .status-not-started {
            background: #e9ecef;
            color: #495057;
        }

        .status-in-progress {
            background: #cfe2ff;
            color: #084298;
        }

        .status-completed {
            background: #d1e7dd;
            color: #0f5132;
        }

        .btn-edit,
        .btn-delete {
            padding: 8px 15px;
            font-size: 14px;
            margin-left: 5px;
        }

        .btn-edit {
            background: #17a2b8;
        }

        .btn-delete {
            background: #dc3545;
        }

        .btn-send-email {
            background: #28a745;
            margin-top: 20px;
            width: 100%;
        }

        .empty-message {
            text-align: center;
            color: #999;
            padding: 40px;
            font-size: 18px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--stat-card-bg);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        .color-picker-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .color-picker-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-picker-item label {
            margin: 0;
            flex: 1;
        }

        .color-picker-item input[type="color"] {
            width: 60px;
            height: 40px;
            padding: 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
        }

        .theme-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .theme-preset {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            transition: all 0.2s;
        }

        .theme-preset:hover {
            border-color: var(--primary-color-1);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .todo-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .header-section {
                flex-direction: column;
                gap: 15px;
            }

            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>ğŸ“‹ Todoç®¡ç†ã‚¢ãƒ—ãƒª</h1>
            <button class="settings-button" onclick="openSettingsModal()">âš™ï¸ è¨­å®š</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="total-count">0</h3>
                <p>ç·ã‚¿ã‚¹ã‚¯æ•°</p>
            </div>
            <div class="stat-card">
                <h3 id="in-progress-count">0</h3>
                <p>é€²è¡Œä¸­</p>
            </div>
            <div class="stat-card">
                <h3 id="not-started-count">0</h3>
                <p>æœªå®Ÿæ–½</p>
            </div>
        </div>

        <div class="todo-list">
            <h2>Todoãƒªã‚¹ãƒˆ</h2>
            <div id="todo-container"></div>
        </div>

        <div class="form-section">
            <h2>æ–°ã—ã„Todoã‚’è¿½åŠ </h2>
            <div class="form-group">
                <label for="todo-text">å®Ÿæ–½äº‹é …</label>
                <input type="text" id="todo-text" placeholder="ã‚„ã‚‹ã¹ãã“ã¨ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="todo-date">ç´æœŸ</label>
                    <input type="date" id="todo-date">
                </div>
                <div class="form-group">
                    <label for="todo-status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select id="todo-status">
                        <option value="not-started">æœªå®Ÿæ–½</option>
                        <option value="in-progress">é€²è¡Œä¸­</option>
                        <option value="completed">å®Œäº†</option>
                    </select>
                </div>
            </div>
            <button class="btn-add" onclick="addTodo()">è¿½åŠ </button>
        </div>

        <button class="btn-send-email" onclick="sendEmail()">ğŸ“§ æœªå®Œäº†ã‚¿ã‚¹ã‚¯ã‚’ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Todoã‚’ç·¨é›†</h2>
            <div class="form-group">
                <label for="edit-text">å®Ÿæ–½äº‹é …</label>
                <input type="text" id="edit-text">
            </div>
            <div class="form-group">
                <label for="edit-date">ç´æœŸ</label>
                <input type="date" id="edit-date">
            </div>
            <div class="form-group">
                <label for="edit-status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                <select id="edit-status">
                    <option value="not-started">æœªå®Ÿæ–½</option>
                    <option value="in-progress">é€²è¡Œä¸­</option>
                    <option value="completed">å®Œäº†</option>
                </select>
            </div>
            <button onclick="saveEdit()">ä¿å­˜</button>
            <button class="btn-delete" onclick="cancelEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSettingsModal()">&times;</span>
            <h2>è¨­å®š</h2>
            
            <div class="form-group">
                <label for="email-address">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" id="email-address" placeholder="nomurakengo@aidemy.co.jp">
            </div>

            <div class="form-group">
                <label>ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒ</label>
                <div class="color-picker-group">
                    <div class="color-picker-item">
                        <label>è‰²1:</label>
                        <input type="color" id="color-1" value="#667eea">
                    </div>
                    <div class="color-picker-item">
                        <label>è‰²2:</label>
                        <input type="color" id="color-2" value="#764ba2">
                    </div>
                </div>
                <div class="theme-presets">
                    <div class="theme-preset" onclick="applyTheme('purple')">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                        ãƒ‘ãƒ¼ãƒ—ãƒ«
                    </div>
                    <div class="theme-preset" onclick="applyTheme('blue')">
                        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                        ãƒ–ãƒ«ãƒ¼
                    </div>
                    <div class="theme-preset" onclick="applyTheme('green')">
                        <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                        ã‚°ãƒªãƒ¼ãƒ³
                    </div>
                    <div class="theme-preset" onclick="applyTheme('orange')">
                        <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                        ã‚ªãƒ¬ãƒ³ã‚¸
                    </div>
                    <div class="theme-preset" onclick="applyTheme('red')">
                        <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                        ãƒ¬ãƒƒãƒ‰
                    </div>
                    <div class="theme-preset" onclick="applyTheme('dark')">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                        ãƒ€ãƒ¼ã‚¯
                    </div>
                </div>
            </div>

            <button onclick="saveSettings()">ä¿å­˜</button>
            <button class="btn-delete" onclick="closeSettingsModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <script>
        /**
         * Todoç®¡ç†ã‚¢ãƒ—ãƒª - è¦ä»¶å®šç¾©æ›¸ã«åŸºã¥ãå®Ÿè£…
         * æ©Ÿèƒ½è¦ä»¶: F-001 ï½ F-015 ã‚’å®Ÿè£…
         * éæ©Ÿèƒ½è¦ä»¶: æ€§èƒ½ã€å¯ç”¨æ€§ã€ä¿å®ˆæ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã™
         */

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let todos = [];                    // æœªå®Œäº†Todoãƒªã‚¹ãƒˆï¼ˆF-009: å®Œäº†ãƒªã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ï¼‰
        let completedTodos = [];            // å®Œäº†Todoãƒªã‚¹ãƒˆï¼ˆé€šå¸¸ç”»é¢ã«ã¯è¡¨ç¤ºã—ãªã„ï¼‰
        let editingIndex = -1;              // ç·¨é›†ä¸­ã®Todoã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
        let emailAddress = 'nomurakengo@aidemy.co.jp';  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆF-012: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
        let emailInterval = null;          // è‡ªå‹•ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

        /**
         * F-015: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½
         * ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«localStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
         */
        function loadTodos() {
            try {
                const saved = localStorage.getItem('todos');
                const savedCompleted = localStorage.getItem('completedTodos');
                const savedEmail = localStorage.getItem('emailAddress');
                const savedTheme = localStorage.getItem('theme');
                
                if (saved) {
                    todos = JSON.parse(saved);
                }
                if (savedCompleted) {
                    completedTodos = JSON.parse(savedCompleted);
                }
                if (savedEmail) {
                    emailAddress = savedEmail;
                }
                if (savedTheme) {
                    const theme = JSON.parse(savedTheme);
                    applyCustomTheme(theme.color1, theme.color2);
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºã®é…åˆ—ã§åˆæœŸåŒ–
                todos = [];
                completedTodos = [];
            }
            
            renderTodos();
            updateStats();
            scheduleDailyEmail();
        }

        /**
         * F-015: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½
         * Todoãƒ‡ãƒ¼ã‚¿ã‚’localStorageã«ä¿å­˜
         */
        function saveTodos() {
            try {
                localStorage.setItem('todos', JSON.stringify(todos));
                localStorage.setItem('completedTodos', JSON.stringify(completedTodos));
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                alert('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }

        /**
         * F-001: Todoç™»éŒ²æ©Ÿèƒ½
         * å®Ÿæ–½äº‹é …ã€ç´æœŸã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å…¥åŠ›ã—ã¦Todoã‚’ç™»éŒ²ã™ã‚‹
         */
        function addTodo() {
            const text = document.getElementById('todo-text').value.trim();
            const date = document.getElementById('todo-date').value;
            const status = document.getElementById('todo-status').value;

            if (!text) {
                alert('å®Ÿæ–½äº‹é …ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (!date) {
                alert('ç´æœŸã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }

            const todo = {
                id: Date.now(),
                text: text,
                date: date,
                status: status,
                createdAt: new Date().toISOString()
            };

            // F-009: å®Œäº†ãƒªã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ - å®Œäº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å ´åˆã¯å®Œäº†ãƒªã‚¹ãƒˆã«è¿½åŠ 
            if (status === 'completed') {
                completedTodos.push(todo);
            } else {
                todos.push(todo);
            }

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('todo-text').value = '';
            document.getElementById('todo-date').value = '';
            document.getElementById('todo-status').value = 'not-started';

            saveTodos();
            renderTodos();
            updateStats();
        }

        /**
         * F-004: Todoå‰Šé™¤æ©Ÿèƒ½
         * å®Œäº†ã—ãŸTodoã‚’å‰Šé™¤ã—ã€å®Œäº†ãƒªã‚¹ãƒˆã«ç§»å‹•ã™ã‚‹ï¼ˆF-009: å®Œäº†ãƒªã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ï¼‰
         */
        function deleteTodo(id) {
            const index = todos.findIndex(t => t.id === id);
            if (index !== -1) {
                const todo = todos[index];
                todo.status = 'completed';
                completedTodos.push(todo);
                todos.splice(index, 1);
                saveTodos();
                renderTodos();
                updateStats();
            }
        }

        /**
         * F-003: Todoç·¨é›†æ©Ÿèƒ½
         * ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã€Todoã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹
         */
        function editTodo(id) {
            const index = todos.findIndex(t => t.id === id);
            if (index !== -1) {
                editingIndex = index;
                const todo = todos[index];
                document.getElementById('edit-text').value = todo.text;
                document.getElementById('edit-date').value = todo.date;
                document.getElementById('edit-status').value = todo.status;
                document.getElementById('editModal').style.display = 'block';
            }
        }

        /**
         * F-003: Todoç·¨é›†æ©Ÿèƒ½
         * ç·¨é›†å†…å®¹ã‚’ä¿å­˜ã™ã‚‹
         * F-009: å®Œäº†ãƒªã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå®Œäº†ã«ãªã£ãŸã‚‰å®Œäº†ãƒªã‚¹ãƒˆã«ç§»å‹•
         */
        function saveEdit() {
            if (editingIndex === -1) return;

            const text = document.getElementById('edit-text').value.trim();
            const date = document.getElementById('edit-date').value;
            const status = document.getElementById('edit-status').value;

            if (!text || !date) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const todo = todos[editingIndex];
            const oldStatus = todo.status;

            todo.text = text;
            todo.date = date;
            todo.status = status;

            // F-009: å®Œäº†ãƒªã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå®Œäº†ã«ãªã£ãŸã‚‰å®Œäº†ãƒªã‚¹ãƒˆã«ç§»å‹•
            if (status === 'completed' && oldStatus !== 'completed') {
                completedTodos.push(todo);
                todos.splice(editingIndex, 1);
            }

            closeEditModal();
            saveTodos();
            renderTodos();
            updateStats();
        }

        /**
         * ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
         */
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingIndex = -1;
        }

        /**
         * ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
         */
        function cancelEdit() {
            closeEditModal();
        }

        /**
         * F-008: ç´æœŸå‰æ—¥è­¦å‘Šæ©Ÿèƒ½
         * ç´æœŸã«åŸºã¥ã„ã¦è­¦å‘Šã‚¯ãƒ©ã‚¹ã‚’æ±ºå®šã™ã‚‹
         * - æœŸé™åˆ‡ã‚Œ: overdue
         * - ç´æœŸå½“æ—¥: due-today
         * - ç´æœŸå‰æ—¥: due-tomorrow
         */
        function getDateClass(dateString) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dueDate = new Date(dateString);
            dueDate.setHours(0, 0, 0, 0);
            const diffTime = dueDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) {
                return 'overdue';      // æœŸé™åˆ‡ã‚Œ
            } else if (diffDays === 0) {
                return 'due-today';    // ç´æœŸå½“æ—¥
            } else if (diffDays === 1) {
                return 'due-tomorrow'; // ç´æœŸå‰æ—¥ï¼ˆF-008è¦ä»¶ï¼‰
            }
            return '';
        }

        /**
         * F-002: Todoãƒªã‚¹ãƒˆè¡¨ç¤ºæ©Ÿèƒ½
         * ç™»éŒ²ã•ã‚ŒãŸTodoã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤ºã™ã‚‹
         * å®Ÿæ–½äº‹é …ã€ç´æœŸã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆF-002è¦ä»¶ï¼‰
         */
        function renderTodos() {
            const container = document.getElementById('todo-container');
            
            if (todos.length === 0) {
                container.innerHTML = '<div class="empty-message">TodoãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ–°ã—ã„Todoã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
                return;
            }

            container.innerHTML = todos.map(todo => {
                const dateClass = getDateClass(todo.date);  // F-008: ç´æœŸå‰æ—¥è­¦å‘Šæ©Ÿèƒ½
                const statusText = {
                    'not-started': 'æœªå®Ÿæ–½',
                    'in-progress': 'é€²è¡Œä¸­',
                    'completed': 'å®Œäº†'
                };
                const formattedDate = new Date(todo.date).toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                return `
                    <div class="todo-item ${dateClass}">
                        <div class="todo-content">${escapeHtml(todo.text)}</div>
                        <div class="todo-date">ğŸ“… ${formattedDate}</div>
                        <div class="todo-status status-${todo.status}">${statusText[todo.status]}</div>
                        <div>
                            <button class="btn-edit" onclick="editTodo(${todo.id})">ç·¨é›†</button>
                            <button class="btn-delete" onclick="deleteTodo(${todo.id})">å®Œäº†</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * F-007: çµ±è¨ˆæƒ…å ±è¡¨ç¤ºæ©Ÿèƒ½
         * ç·ã‚¿ã‚¹ã‚¯æ•°ã€é€²è¡Œä¸­ã€æœªå®Ÿæ–½ã®æ•°ã‚’çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹
         */
        function updateStats() {
            const notStarted = todos.filter(t => t.status === 'not-started').length;
            const inProgress = todos.filter(t => t.status === 'in-progress').length;
            
            document.getElementById('total-count').textContent = todos.length;
            document.getElementById('in-progress-count').textContent = inProgress;
            document.getElementById('not-started-count').textContent = notStarted;
        }

        /**
         * XSSå¯¾ç­–: HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
         * ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å€¤ã‚’å®‰å…¨ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * F-011: æ‰‹å‹•ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½
         * F-010: è‡ªå‹•ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ï¼ˆã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ï¼‰
         * æœªå®Œäº†ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæœªå®Ÿæ–½ã€é€²è¡Œä¸­ï¼‰ã®Todoã‚’ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã™ã‚‹
         * mailtoãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’é–‹ã
         */
        function sendEmail() {
            const incompleteTodos = todos.filter(t => t.status !== 'completed');
            
            if (incompleteTodos.length === 0) {
                alert('æœªå®Œäº†ã®TodoãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            let emailBody = 'æœªå®Œäº†ã®Todoãƒªã‚¹ãƒˆ\n\n';
            incompleteTodos.forEach((todo, index) => {
                const statusText = {
                    'not-started': 'æœªå®Ÿæ–½',
                    'in-progress': 'é€²è¡Œä¸­'
                };
                const formattedDate = new Date(todo.date).toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                emailBody += `${index + 1}. ${todo.text}\n`;
                emailBody += `   ç´æœŸ: ${formattedDate}\n`;
                emailBody += `   ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${statusText[todo.status]}\n\n`;
            });

            // mailtoãƒªãƒ³ã‚¯ã‚’ä½œæˆï¼ˆè¦ä»¶: mailtoãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ï¼‰
            const subject = encodeURIComponent('æœªå®Œäº†Todoãƒªã‚¹ãƒˆ');
            const body = encodeURIComponent(emailBody);
            const mailtoLink = `mailto:${emailAddress}?subject=${subject}&body=${body}`;
            
            try {
                window.location.href = mailtoLink;
            } catch (error) {
                console.error('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                alert('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }

        /**
         * F-010: è‡ªå‹•ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½
         * æœªå®Œäº†ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæœªå®Ÿæ–½ã€é€²è¡Œä¸­ï¼‰ã®Todoã‚’æ¯æœ6æ™‚ã«æŒ‡å®šãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«è‡ªå‹•é€ä»˜ã™ã‚‹
         * æ³¨æ„: ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã®ã¿å‹•ä½œã™ã‚‹
         */
        function scheduleDailyEmail() {
            // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
            if (emailInterval) {
                clearInterval(emailInterval);
            }

            const now = new Date();
            const sixAM = new Date();
            sixAM.setHours(6, 0, 0, 0);

            // 6æ™‚ã‚’éãã¦ã„ã‚‹å ´åˆã¯ç¿Œæ—¥ã®6æ™‚ã«è¨­å®š
            if (now > sixAM) {
                sixAM.setDate(sixAM.getDate() + 1);
            }

            const timeUntilSixAM = sixAM - now;

            setTimeout(() => {
                sendEmail();
                // 24æ™‚é–“ã”ã¨ã«ç¹°ã‚Šè¿”ã—
                emailInterval = setInterval(sendEmail, 24 * 60 * 60 * 1000);
            }, timeUntilSixAM);
        }

        /**
         * è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
         * F-012: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®šæ©Ÿèƒ½
         * F-013: ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒå¤‰æ›´æ©Ÿèƒ½
         */
        function openSettingsModal() {
            document.getElementById('email-address').value = emailAddress;
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                try {
                    const theme = JSON.parse(savedTheme);
                    document.getElementById('color-1').value = theme.color1;
                    document.getElementById('color-2').value = theme.color2;
                } catch (error) {
                    console.error('ãƒ†ãƒ¼ãƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                }
            }
            document.getElementById('settingsModal').style.display = 'block';
        }

        /**
         * è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
         */
        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        /**
         * F-012: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®šæ©Ÿèƒ½
         * F-013: ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒå¤‰æ›´æ©Ÿèƒ½
         * è¨­å®šã‚’ä¿å­˜ã™ã‚‹
         */
        function saveSettings() {
            const newEmail = document.getElementById('email-address').value.trim();
            if (newEmail && newEmail.includes('@')) {
                emailAddress = newEmail;
                try {
                    localStorage.setItem('emailAddress', emailAddress);
                } catch (error) {
                    console.error('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                }
            }

            const color1 = document.getElementById('color-1').value;
            const color2 = document.getElementById('color-2').value;
            applyCustomTheme(color1, color2);
            
            const theme = { color1, color2 };
            try {
                localStorage.setItem('theme', JSON.stringify(theme));
            } catch (error) {
                console.error('ãƒ†ãƒ¼ãƒã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }

            closeSettingsModal();
            scheduleDailyEmail();  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´æ™‚ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å†è¨­å®š
        }

        /**
         * F-013: ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒå¤‰æ›´æ©Ÿèƒ½
         * ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã‚’é©ç”¨ã™ã‚‹
         */
        function applyCustomTheme(color1, color2) {
            document.documentElement.style.setProperty('--primary-color-1', color1);
            document.documentElement.style.setProperty('--primary-color-2', color2);
            document.documentElement.style.setProperty('--stat-card-bg', `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`);
            document.documentElement.style.setProperty('--button-bg', `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`);
            document.documentElement.style.setProperty('--body-bg', `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`);
        }

        /**
         * F-013: ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒå¤‰æ›´æ©Ÿèƒ½
         * ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ãƒ¼ãƒã‚’é©ç”¨ã™ã‚‹
         */
        function applyTheme(themeName) {
            const themes = {
                purple: { color1: '#667eea', color2: '#764ba2' },
                blue: { color1: '#4facfe', color2: '#00f2fe' },
                green: { color1: '#43e97b', color2: '#38f9d7' },
                orange: { color1: '#fa709a', color2: '#fee140' },
                red: { color1: '#ff6b6b', color2: '#ee5a6f' },
                dark: { color1: '#2c3e50', color2: '#34495e' }
            };

            const theme = themes[themeName];
            if (theme) {
                document.getElementById('color-1').value = theme.color1;
                document.getElementById('color-2').value = theme.color2;
                applyCustomTheme(theme.color1, theme.color2);
            }
        }

        /**
         * ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: Enterã‚­ãƒ¼ã§Todoã‚’è¿½åŠ 
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶: æ“ä½œã¯å³åº§ã«åæ˜ ã•ã‚Œã‚‹
         */
        document.getElementById('todo-text').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTodo();
            }
        });

        /**
         * ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
         */
        window.onclick = function(event) {
            const editModal = document.getElementById('editModal');
            const settingsModal = document.getElementById('settingsModal');
            if (event.target === editModal) {
                closeEditModal();
            }
            if (event.target === settingsModal) {
                closeSettingsModal();
            }
        }

        /**
         * åˆæœŸåŒ–å‡¦ç†
         * ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã€ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶: ç”»é¢è¡¨ç¤ºã¯1ç§’ä»¥å†…
         */
        loadTodos();
    </script>
</body>
</html>
